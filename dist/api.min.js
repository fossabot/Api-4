!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Api=t()}(this,function(){"use strict";var e=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},t="undefined"!=typeof console;var n=function(e,t){return Object.keys(e).forEach(function(n){return t[n]=e[n]})},o=document.getElementsByTagName("head")[0];function r(e){window[e]=void 0}function i(e){o.removeChild(document.getElementById(e))}function a(e){var n=e.href,a=e.timeout,u=e.callbackName,c=e.callbackId||"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random()),s=""+n+(/\?/.test(n)?"&":"?")+u+"="+c;return new Promise(function(e,n){var u,f,d,l=setTimeout(function(){!function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t&&console.error.apply(console,e)}("JSONP request to "+s+" timed out"),n(s),r(c),i(c)},a);window[c]=function(t){e(t),l&&clearTimeout(l),r(c),i(c)},u=c,f=s,(d=document.createElement("script")).id=u,d.setAttribute("src",f),o.appendChild(d)})}function u(e){var t=e.url,n=e.search,o=e.input,r=e.dataType,i=e.methods,a=e.async,u=e.withCredentials,c=e.header,s=e.timeout,f=e.xhrEvent,d=new XMLHttpRequest;return new Promise(function(e,l){var p,h,m,y,v="json"===r?n.slice(1):(p=o,h=new FormData,Object.keys(p).forEach(function(e){return h.append(e,p[e])}),h);d.withCredentials=u,d.timeout=s,d.open(i,t,a),function(e,t){for(var n in t)e.setRequestHeader(n,t[n])}(d,c),d.send(v),m=d,y=f,Object.keys(y).forEach(function(e){m.addEventListener(e,y[e])}),"function"==typeof y.uploadProgress&&m.upload&&m.upload.addEventListener("progress",y.uploadProgress),d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var t=d.response;"object"!=typeof t&&(t=JSON.parse(t)),e(t)}else l(d)}})}var c=/^([a-z][a-z\d\+\-\.]*:)?\/\//i,s={domain:window.location.href,methods:"GET",dataType:"json",timeout:1e4,useMock:!1,input:{},mock:{},callbackName:"callback",callbackId:0,withCredentials:!1,urlModel:0,debug:!1,async:!0,filter:function(e){return e},header:{},xhrEvent:{}},f=function(){function e(e){this.mixins(e)}return e.prototype.mixins=function(e){n(e,this)},Object.defineProperty(e.prototype,"href",{get:function(){return this.url+this.search},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"search",{get:function(){return"?"+(e=this.filter(this.input),Object.keys(e).map(function(t){return t+"="+e[t]}).join("&"));var e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){var e=this.urlModel,t=this.domain,n=this.namespace;return 1===e?t:c.test(n)?n:t+n},enumerable:!0,configurable:!0}),e.prototype.send=function(){return this.debug&&function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t&&console.log.apply(console,e)}(""+this.namespace,this.input),this.useMock?Promise.resolve(this.mock):"jsonp"===this.dataType?a(this):u(this)},e}(),d={},l={};return{define:function(e,n){void 0===n&&(n={}),d[e]&&function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t&&console.warn.apply(console,e)}("redefine "+e),d[e]=new f(n)},config:function(e){void 0===e&&(e={}),n(e,l)},require:function(t,n,o){void 0===n&&(n={}),void 0===o&&(o={}),d[t]||this.define(t);var r=d[t];return r.mixins(e({},s,l,r,o,{namespace:t,input:n})),r.send()},get:function(e){return d[e]}}});
